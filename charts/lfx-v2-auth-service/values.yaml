# Copyright The Linux Foundation and each contributor to LFX.
# SPDX-License-Identifier: MIT
---
image:
  repository: ghcr.io/linuxfoundation/lfx-v2-auth-service/server
  # tag is the container image tag (overrides appVersion from Chart.yaml)
  tag: ""
  # pullPolicy is the image pull policy
  pullPolicy: IfNotPresent

# service is the configuration for the Kubernetes service
service:
  # port is the service port
  port: 8080

nats:
  # url is the URL of the NATS server
  url: nats://lfx-platform-nats.lfx.svc.cluster.local:4222

  ## ** IMPORTANT **
  ## This should used for local development - it's disabled by default.
  ## If you set the REPO_TYPE to authelia, it should be enabled -> creation: true
  ##
  # authelia_users_kv_bucket is the configuration for the KV bucket for storing authelia_users
  authelia_users_kv_bucket:
    # creation is a boolean to determine if the KV bucket should be created via the helm chart.
    # set it to false if you want to use an existing KV bucket.
    creation: true
    # keep is a boolean to determine if the KV bucket should be preserved during helm uninstall
    # set it to false if you want the bucket to be deleted when the chart is uninstalled
    keep: true
    # name is the name of the KV bucket for storing projects
    name: authelia-users
    # history is the number of history entries to keep for the KV bucket
    history: 5
    # storage is the storage type for the KV bucket
    storage: file
    # maxValueSize is the maximum size of a value in the KV bucket
    maxValueSize: 1048576  # 1MB (sufficient for user data)
    # maxBytes is the maximum number of bytes in the KV bucket
    maxBytes: 52428800  # 50MB (generous for ~100 users)
    # compression is a boolean to determine if the KV bucket should be compressed
    compression: true

# app is the configuration for the application
app:
  # use_oidc_contextualizer is a boolean to determine if the OIDC contextualizer should be used
  use_oidc_contextualizer: true
  # environment is the configuration for the application environment
  environment:
    # NATS Configuration
    NATS_URL:
      value: nats://lfx-platform-nats.lfx.svc.cluster.local:4222
    # Repository type for user management
    # It can be authelia, auth0 or mock
    # If not set, it will default to mock
    USER_REPOSITORY_TYPE:
      value: mock

    # Auth0 Management API configuration
    ## Optional when using mock or authelia repository type
    AUTH0_TENANT:
      value: null
    AUTH0_DOMAIN:
      value: null
    # Auth0 M2M Authentication configuration
    ## Required when using auth0 repository type
    AUTH0_CLIENT_ID:
      value: null
    AUTH0_PRIVATE_BASE64_KEY:
      value: null
    AUTH0_AUDIENCE:
      value: null

    # Authelia configuration
    ## Required when using authelia repository type
    AUTHELIA_CONFIGMAP_NAME:
      value: lfx-platform-authelia
    AUTHELIA_CONFIGMAP_NAMESPACE:
      value: lfx
    AUTHELIA_DAEMONSET_NAME:
      value: lfx-platform-authelia
    AUTHELIA_SECRET_NAME:
      value: authelia-users
    AUTHELIA_USERS_FILE_KEY:
      value: users_database.yml
